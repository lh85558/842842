
#!/bin/sh
# Print server monitoring script

LOG_FILE="/var/log/print-server.log"
PRINTER_CHECK_INTERVAL=300  # 5 minutes

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$LOG_FILE"
}

check_printers() {
    # Check USB printers
    if lsusb | grep -q "Printer\|HP\|Canon\|Epson"; then
        log_message "USB printer detected"
        
        # Restart CUPS if needed
        if ! pgrep cupsd > /dev/null; then
            log_message "CUPS not running, restarting..."
            /etc/init.d/cups-setup restart
        fi
    fi
    
    # Check network printers
    if avahi-browse -a 2>/dev/null | grep -q "_printer._tcp"; then
        log_message "Network printer detected via mDNS"
    fi
}

# Main monitoring loop
while true; do
    check_printers
    sleep "$PRINTER_CHECK_INTERVAL"
done
