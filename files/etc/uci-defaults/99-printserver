
#!/bin/sh
# Print server default configuration

# Set hostname
uci set system.@system[0].hostname='THDN-PrintServer'
uci commit system

# Configure CUPS firewall rules
uci add firewall rule
uci set firewall.@rule[-1].name='Allow-CUPS-631'
uci set firewall.@rule[-1].src='wan'
uci set firewall.@rule[-1].proto='tcp'
uci set firewall.@rule[-1].dest_port='631'
uci set firewall.@rule[-1].target='ACCEPT'
uci commit firewall

# Configure p910nd
uci set p910nd.@p910nd[0].enabled='1'
uci set p910nd.@p910nd[0].interface='lan'
uci set p910nd.@p910nd[0].port='9100'
uci set p910nd.@p910nd[0].bidirectional='1'
uci commit p910nd

# Enable services
/etc/init.d/cups-setup enable
/etc/init.d/p910nd enable
/etc/init.d/cron enable

# Set admin password
echo 'admin:thdn12345678' | chpasswd

# Create log directory
mkdir -p /var/log
touch /var/log/print-server.log
chmod 644 /var/log/print-server.log

exit 0
