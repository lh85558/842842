
# TP-LINK TL-WR842N V3 固件刷写指南

## 刷写前准备

### ⚠️ 重要警告
- **刷机有风险，请谨慎操作**
- **确保电源稳定，避免断电**
- **备份原厂固件（如果可能）**
- **确认路由器型号为 TL-WR842N V3**

### 硬件确认
- 型号：TL-WR842N V3
- 闪存：16MB
- 内存：64MB
- USB 接口：1×USB 2.0

### 所需工具
- 网线（连接电脑和路由器）
- 固件文件（factory.bin）
- 电脑（Windows/Linux/macOS）

## 刷写方法

### 方法 1: Web 界面刷写（推荐）

#### 步骤 1: 连接路由器
1. 用网线连接电脑和路由器的 LAN 口
2. 设置电脑 IP 为自动获取（DHCP）

#### 步骤 2: 访问管理界面
1. 打开浏览器访问 `http://192.168.0.1`
2. 输入用户名和密码（默认通常是 admin/admin）

#### 步骤 3: 进入升级页面
1. 找到 "系统工具" → "软件升级"
2. 或 "管理" → "固件升级"

#### 步骤 4: 选择固件
1. 点击 "浏览" 或 "选择文件"
2. 选择 `*factory.bin` 文件
3. 点击 "升级" 或 "上传"

#### 步骤 5: 等待完成
1. **不要断电或刷新页面**
2. 等待 3-5 分钟
3. 路由器会自动重启

#### 步骤 6: 验证
1. 路由器重启后，访问 `http://192.168.10.1`
2. 使用 admin/thdn12345678 登录
3. 检查系统信息确认刷写成功

### 方法 2: TFTP 刷写（救砖用）

#### 步骤 1: 准备 TFTP 服务器

**Windows:**
```bash
# 安装 TFTP 服务器
# 推荐：Tftpd64 或 SolarWinds TFTP Server
```

**Linux:**
```bash
# 安装 TFTP 服务器
sudo apt-get install tftpd-hpa

# 配置 TFTP
sudo mkdir -p /tftpboot
sudo chmod 777 /tftpboot
sudo cp your-firmware.bin /tftpboot/

# 启动 TFTP 服务
sudo systemctl start tftpd-hpa
```

#### 步骤 2: 进入 TFTP 模式
1. 关闭路由器电源
2. 按住 Reset 按钮
3. 开启电源，保持按住 Reset
4. 等待 5-8 秒后松开
5. 路由器指示灯会快速闪烁

#### 步骤 3: 开始刷写
```bash
# Linux/macOS
tftp 192.168.0.1
tftp> binary
tftp> put factory.bin
tftp> quit

# 或命令行
tftp -m binary 192.168.0.1 -c put factory.bin
```

#### 步骤 4: 等待完成
1. 传输完成后等待 3-5 分钟
2. 路由器会自动重启
3. 指示灯恢复正常状态

### 方法 3: 串口刷写（终极救砖）

#### 准备工具
- USB 转 TTL 串口线
- 杜邦线（4根）
- 焊接工具（可选）

#### 连接串口
```
路由器串口引脚：
TX  → 串口 RX
RX  → 串口 TX
GND → 串口 GND
3.3V→ 不需要连接
```

#### 串口参数
- 波特率：115200
- 数据位：8
- 停止位：1
- 校验位：无
- 流控：无

#### 刷写步骤
1. 连接串口线
2. 打开串口终端（minicom、putty等）
3. 开启路由器电源
4. 在 U-Boot 阶段按任意键中断启动
5. 执行刷写命令：
```bash
# 设置 IP
setenv ipaddr 192.168.1.1
setenv serverip 192.168.1.100

# 通过 TFTP 刷写
tftpboot 0x81000000 factory.bin
erase 0x9f020000 0x7c0000
cp.b 0x81000000 0x9f020000 0x7c0000
reset
```

## 刷写后配置

### 首次登录
1. 访问 `http://192.168.10.1`
2. 用户名：admin
3. 密码：thdn12345678

### 基本设置
1. **修改管理员密码**
   - 系统 → 管理 → 修改密码

2. **配置网络**
   - 网络 → 接口 → LAN
   - 默认 IP：192.168.10.1

3. **设置 WiFi**
   - 网络 → 无线
   - SSID：THDN-dayin
   - 密码：thdn12345678

### 打印服务配置

#### 连接打印机
1. 通过 USB 连接打印机
2. 访问 CUPS 管理界面：`http://192.168.10.1:631`
3. 点击 "添加打印机"
4. 选择检测到的打印机
5. 安装对应驱动

#### 网络打印设置
1. **IPP 打印**
   - 地址：`ipp://192.168.10.1:631/printers/打印机名`
   
2. **RAW 打印**
   - 地址：`socket://192.168.10.1:9100`

#### Windows 客户端
```bash
# 添加网络打印机
控制面板 → 设备和打印机 → 添加打印机
→ 选择网络打印机 → 输入 IPP 地址
→ 安装驱动程序 → 完成
```

#### macOS 客户端
```bash
# 添加 IP 打印机
系统偏好设置 → 打印机与扫描仪
→ 添加 → IP → 协议：IPP
→ 地址：192.168.10.1
→ 队列：/printers/打印机名
```

## 故障排除

### 刷写失败

#### 症状：无法访问管理界面
**解决方案：**
1. 检查 IP 设置（192.168.10.1）
2. 尝试 ping 路由器
3. 检查网线连接
4. 尝试恢复出厂设置

#### 症状：指示灯异常
**解决方案：**
1. 观察指示灯状态
2. 参考路由器说明书
3. 可能需要重新刷写

#### 症状：无限重启
**解决方案：**
1. 尝试 TFTP 刷写
2. 检查固件文件完整性
3. 使用串口刷写救砖

### 恢复原厂固件

#### 方法 1: 使用备份
```bash
# 如果有备份文件
# 通过 Web 界面刷入原厂备份
```

#### 方法 2: 官方救砖
1. 下载官方固件
2. 使用 TFTP 刷写
3. 联系 TP-LINK 技术支持

### 获取帮助

#### 日志查看
```bash
# 查看系统日志
logread

# 查看内核日志
dmesg

# 查看 CUPS 日志
cat /var/log/cups/error_log
```

#### 网络诊断
```bash
# 检查网络配置
ifconfig
route -n

# 检查端口
netstat -tlnp

# 检查服务状态
/etc/init.d/cups status
/etc/init.d/p910nd status
```

## 安全建议

### 基本安全
1. **修改默认密码**
2. **启用防火墙**
3. **关闭不必要的服务**
4. **定期更新固件**

### 网络安全
1. **使用强 WiFi 密码**
2. **启用 WPA2/WPA3**
3. **关闭 WPS**
4. **启用 MAC 过滤**

### 远程访问
1. **限制远程访问**
2. **使用 VPN**
3. **启用 HTTPS**
4. **配置访问控制**

## 技术支持

### 在线资源
- [OpenWrt 官方文档](https://openwrt.org/docs/start)
- [CUPS 文档](https://www.cups.org/doc/)
- [项目 GitHub](https://github.com/your-repo)

### 社区支持
- OpenWrt 中文论坛
- 恩山无线论坛
- GitHub Issues

### 联系方式
如有问题，请在 GitHub 提交 Issue 或讨论。
